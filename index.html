<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>GBPUSD & USDJPY Pro Calc</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* --- Global Variables --- */
    :root {
        /* Layout & Basics */
        --bg-color: #f0f2f5;
        --card-bg: #ffffff;
        --text-color: #1c1e21;
        --input-bg: #f8f9fa;
        --border-color: #dee2e6;
        --label-color: #606770;
        
        /* Dynamic Theme Variables (Default: GBPUSD/Blue) */
        --theme-primary: #0077B6; /* Default Blue for GBPUSD */
        --theme-gradient: linear-gradient(135deg, #0077B6, #0096C7);
        --table-header-bg: linear-gradient(45deg, #0077B6, #0096C7);
        --table-header-text: #ffffff;
        --active-btn-text: #ffffff;
        --focus-glow: rgba(0, 119, 182, 0.35);
        
        --result-bg: #f0f8ff;
        --result-text: #0077B6; 
        
        --btn-buy-bg: linear-gradient(45deg, #28a745, #218838);
        --btn-sell-bg: linear-gradient(45deg, #dc3545, #c82333);

        /* --- New Theme Variables for Currencies --- */
        /* GBPUSD */
        --gbpusd-primary: #0077B6; 
        --gbpusd-gradient-light: linear-gradient(135deg, #0077B6, #0096C7);
        --gbpusd-gradient-dark: linear-gradient(135deg, #023E8A, #0077B6);
        
        /* USDJPY */
        --usdjpy-primary-light: #D00000;
        --usdjpy-gradient-light: linear-gradient(135deg, #A80000, #D00000);
        --usdjpy-primary-dark: #B71C1C;
        --usdjpy-gradient-dark: linear-gradient(135deg, #9A1818, #B71C1C);
    }

    /* Dark Mode */
    body.dark {
        --bg-color: #18191a;
        --card-bg: #242526;
        --text-color: #e4e6eb;
        --input-bg: #3a3b3c;
        --border-color: #3e4042;
        --label-color: #b0b3b8;
        
        --result-bg: #2a2b2c;
    }

    /* --- Reset & Layout --- */
    * { box-sizing: border-box; outline: none; }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--bg-color);
        background-image:
            linear-gradient(135deg, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0.12) 30%, rgba(255,255,255,0) 60%),
            repeating-linear-gradient(135deg, rgba(255,255,255,0.18) 0 1px, transparent 1px 8px);
        background-blend-mode: overlay, normal;
        background-attachment: fixed;
        color: var(--text-color);
        margin: 0;
        min-height: 100vh;
        display: flex; 
        justify-content: center;
        align-items: center;
        padding: 20px;
        transition: background 0.3s ease;
    }

    .container {
        background: var(--card-bg);
        width: 100%;
        max-width: 500px;
        padding: 35px 30px;
        border-radius: 20px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

    /* --- Inputs (Spinner Removed) --- */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type=number] {
        -moz-appearance: textfield;
    }

    input[type="number"] {
        width: 100%;
        padding: 15px;
        font-size: 16px;
        border-radius: 12px;
        border: 1.5px solid var(--border-color);
        background: var(--input-bg);
        color: var(--text-color);
        font-weight: 500;
        transition: all 0.2s;
        display: block;
    }

    input[type="number"]:focus {
        border-color: var(--theme-primary);
        box-shadow: 0 0 0 4px var(--focus-glow);
    }

    label {
        display: block;
        margin: 18px 0 8px;
        font-weight: 600;
        font-size: 15px;
        color: var(--label-color);
        text-align: left;
    }

    /* --- Selection Buttons --- */
    .row-group {
        display: flex;
        gap: 12px;
        margin-bottom: 5px;
    }

    .choice-btn {
        flex: 1;
        padding: 14px;
        font-size: 15px;
        font-weight: 600;
        border-radius: 12px;
        border: 1.5px solid var(--border-color);
        background: var(--input-bg);
        color: var(--label-color);
        cursor: pointer;
        transition: all 0.2s ease;
        /* Mobile Fixes */
        -webkit-tap-highlight-color: transparent;
        user-select: none; 
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }

    .choice-btn:hover {
        background: var(--border-color);
    }

    /* Active States */
    .choice-btn.active {
        background: var(--theme-gradient);
        color: var(--active-btn-text);
        border: none;
        box-shadow: 
            0 4px 12px -2px var(--focus-glow), 
            0 0 0 2px var(--theme-primary),
            inset 0 0 0 1px rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
    }
    
    .choice-btn:active:not(.active) {
        box-shadow: 0 0 0 2px var(--theme-primary); 
        transform: translateY(0);
    }

    /* Specific Active Colors Overrides */
    
    /* GBPUSD Theme (Blue/Slightly Darker Blue) */
    #btnGBPUSD.active {
        background: var(--theme-gradient); /* Controlled by setTheme */
        color: #ffffff;
        box-shadow: 
            0 4px 12px -2px rgba(0, 119, 182, 0.4),
            0 0 0 2px var(--theme-primary), 
            inset 0 0 0 1px rgba(255, 255, 255, 0.3);
    }
    
    /* USDJPY Theme (Light Mode - Red/Maroon for Japan) */
    #btnUSDJPY.active {
        background: var(--usdjpy-gradient-light); 
        color: #ffffff;
        box-shadow: 
            0 4px 12px -2px rgba(168, 0, 0, 0.4),
            0 0 0 2px var(--usdjpy-primary-light), 
            inset 0 0 0 1px rgba(255, 255, 255, 0.3);
    }

    /* Dark Mode specific for USDJPY (Dark Red/Crimson) */
    body.dark #btnUSDJPY.active {
        background: var(--usdjpy-gradient-dark);
        color: #ffffff;
        box-shadow: 
            0 4px 12px -2px rgba(183, 28, 28, 0.4),
            0 0 0 2px var(--usdjpy-primary-dark), 
            inset 0 0 0 1px rgba(255, 255, 255, 0.3);
    }
    
    /* Dark Mode specific for GBPUSD (Darker Blue) */
    body.dark #btnGBPUSD.active {
        background: var(--gbpusd-gradient-dark); /* Controlled by setTheme */
        color: #ffffff;
        box-shadow: 
            0 4px 12px -2px rgba(2, 62, 138, 0.4),
            0 0 0 2px var(--gbpusd-primary), 
            inset 0 0 0 1px rgba(255, 255, 255, 0.3);
    }


    /* --- Action Buttons --- */
    .action-group {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }

    .action-btn {
        flex: 1;
        padding: 16px;
        font-size: 17px;
        font-weight: 700;
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        -webkit-user-select: none;
    }

    .btn-buy { background: var(--btn-buy-bg); }
    .btn-sell { background: var(--btn-sell-bg); }

    .action-btn:active { 
        transform: scale(0.98); 
        box-shadow: 0 2px 5px rgba(0,0,0,0.2), 0 0 0 2px rgba(255,255,255,0.1);
    }
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    /* --- Result Area & Table --- */
    .result-card {
        width: 100%; 
        margin-top: 30px;
        background: var(--result-bg);
        padding: 0;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid rgba(0,0,0,0.05);
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        display: none; 
        animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    table { width: 100%; border-collapse: collapse; }
    
    /* Dynamic Header Style */
    th {
        background: var(--table-header-bg); 
        color: var(--table-header-text); 
        padding: 15px;
        text-align: left;
        font-weight: 700; 
        font-size: 16px;
    }

    td {
        padding: 14px 15px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        color: var(--text-color);
        font-weight: 500;
        font-size: 16px;
    }
    
    tr:last-child td { border-bottom: none; }
    
    td:last-child { 
        text-align: right; 
        font-weight: 700; 
        color: var(--result-text); 
        white-space: nowrap; 
    }

    .profit-val { color: #28a745 !important; }
    .loss-val { color: #dc3545 !important; }

    /* --- Copy Icon --- */
    .copy-icon {
        width: 18px; height: 18px;
        cursor: pointer;
        fill: var(--label-color); 
        transition: fill 0.2s;
        vertical-align: middle;
        margin-left: 8px;
        display: inline-block;
    }
    .copy-icon:hover { fill: var(--theme-primary); transform: scale(1.1); }

    /* --- Mobile Optimization --- */
    @media (max-width: 600px) {
        body { padding: 10px; align-items: flex-start; }
        .container {
            padding: 20px 15px;
            margin-top: 10px;
        }
    }
</style>
</head>
<body>

    <div class="container">
        <label></label>
        <div class="row-group">
            <button id="btnGBPUSD" class="choice-btn active" onclick="selectCurrency('GBPUSD')">GBPUSD</button>
            <button id="btnUSDJPY" class="choice-btn" onclick="selectCurrency('USDJPY')">USDJPY</button>
        </div>
        <input type="hidden" id="currencyPair" value="GBPUSD">

        <label>Account Size ($)</label>
        <input type="number" id="forexAccountSize" inputmode="decimal">

        <label>Risk (%)</label>
        <div class="row-group">
            <button id="btnRisk1" class="choice-btn active" onclick="selectRisk(1)">1%</button>
            <button id="btnRisk05" class="choice-btn" onclick="selectRisk(0.5)">0.5%</button>
        </div>
        <input type="hidden" id="forexRiskPercent" value="1">

        <label>Entry Price</label>
        <input type="number" id="forexEntryPrice" inputmode="decimal">

        <label id="tpLabel" style="color:#28a745">TP (Pips)</label>
        <input type="number" id="forexTpPips" inputmode="decimal">

        <label id="slLabel" style="color:#dc3545">SL (Pips)</label>
        <input type="number" id="forexStopPips" inputmode="decimal">

        <div class="action-group">
            <button class="action-btn btn-sell" onclick="calculateForex('short')">Sell</button>
            <button class="action-btn btn-buy" onclick="calculateForex('long')">Buy</button>
        </div>

        <div id="output" class="result-card"></div>
    </div>

    <script>
        // --- Helper: Copy to Clipboard ---
        function copyText(txt, btn) {
            navigator.clipboard.writeText(txt);
            let original = btn.innerHTML;
            btn.innerHTML = `<svg viewBox="0 0 24 24" width="18" height="18" fill="#28a745"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>`;
            setTimeout(() => btn.innerHTML = original, 1500);
        }

        // --- Theme Manager ---
        function setTheme(pair) {
            const r = document.documentElement.style;
            const isDark = document.body.classList.contains('dark');
            
            if (pair === 'GBPUSD') { 
                // GBPUSD Theme (Blue/Dark Blue)
                const gbpPrimary = r.getPropertyValue('--gbpusd-primary');
                const gbpGradient = isDark ? r.getPropertyValue('--gbpusd-gradient-dark') : r.getPropertyValue('--gbpusd-gradient-light');

                r.setProperty('--theme-primary', gbpPrimary);
                r.setProperty('--theme-gradient', gbpGradient);
                r.setProperty('--table-header-bg', gbpGradient);
                r.setProperty('--table-header-text', '#ffffff');
                r.setProperty('--active-btn-text', '#ffffff');
                r.setProperty('--result-text', gbpPrimary);
                r.setProperty('--focus-glow', 'rgba(0, 119, 182, 0.35)');

            } else if (pair === 'USDJPY') {
                // USDJPY Theme (Red/Crimson)
                const jpyDarkPrimary = r.getPropertyValue('--usdjpy-primary-dark'); 
                const jpyDarkGradient = r.getPropertyValue('--usdjpy-gradient-dark');
                const jpyLightPrimary = r.getPropertyValue('--usdjpy-primary-light'); 
                const jpyLightGradient = r.getPropertyValue('--usdjpy-gradient-light');
                
                r.setProperty('--theme-primary', isDark ? jpyDarkPrimary : jpyLightPrimary); 
                r.setProperty('--theme-gradient', isDark ? jpyDarkGradient : jpyLightGradient);
                r.setProperty('--table-header-bg', isDark ? jpyDarkGradient : jpyLightGradient);
                r.setProperty('--table-header-text', '#ffffff');
                r.setProperty('--active-btn-text', '#ffffff');
                r.setProperty('--result-text', isDark ? jpyDarkPrimary : jpyLightPrimary); 
                r.setProperty('--focus-glow', isDark ? 'rgba(183, 28, 28, 0.35)' : 'rgba(208, 0, 0, 0.35)');
            }
        }

        // --- Selection Logic ---
        function selectCurrency(pair) {
            document.querySelectorAll('.choice-btn').forEach(b => {
                if(b.id === 'btnGBPUSD' || b.id === 'btnUSDJPY') {
                    b.classList.remove('active');
                }
            });
            document.getElementById(`btn${pair}`).classList.add('active');
            document.getElementById('currencyPair').value = pair;
            
            const suffix = '(Pips)'; 
            document.getElementById('tpLabel').textContent = `TP ${suffix}`;
            document.getElementById('slLabel').textContent = `SL ${suffix}`;
            
            setTheme(pair);
        }

        function selectRisk(val) {
            document.getElementById('btnRisk1').classList.remove('active');
            document.getElementById('btnRisk05').classList.remove('active');
            document.getElementById(val === 1 ? 'btnRisk1' : 'btnRisk05').classList.add('active');
            document.getElementById('forexRiskPercent').value = val;
        }

        // --- Core Calculation ---
        function calculateForex(tradeType) {
            const pair = document.getElementById('currencyPair').value;
            let accountSize = parseFloat(document.getElementById('forexAccountSize').value);
            const riskPercent = parseFloat(document.getElementById('forexRiskPercent').value);
            let entryPrice = parseFloat(document.getElementById('forexEntryPrice').value);
            let slPips = parseFloat(document.getElementById('forexStopPips').value);
            let tpPips = parseFloat(document.getElementById('forexTpPips').value);
            
            setTheme(pair); 
            
            const out = document.getElementById('output');
            out.style.display = 'block';

            // --- Configuration and Auto-Fill Defaults ---
            const isGBPUSD = pair === 'GBPUSD';
            
            let defaultEntry, defaultSL, defaultTP, config;

            if (isGBPUSD) {
                // GBPUSD Configuration (Standard Major Pair)
                defaultEntry = 1.25000;
                defaultSL = 40;       // 40 pips = 0.0040 move
                defaultTP = 80;       // 80 pips = 0.0080 move
                config = { 
                    pipSize: 0.0001,        // Price unit per pip (1/10000)
                    contractSize: 100000,   // Standard lot size 
                    precision: 5          // Display precision for price (4 decimals + pipet)
                };
            } else if (pair === 'USDJPY') {
                // USDJPY Configuration (Yen Pair)
                defaultEntry = 155.000;
                defaultSL = 20;       // 20 pips = 0.20 move
                defaultTP = 40;       // 40 pips = 0.40 move
                config = { 
                    pipSize: 0.01,        // Price unit per pip (1 cent / 1 JPY)
                    contractSize: 100000, // Standard lot size 
                    precision: 3          // Display precision for price
                }; 
            } else {
                // Fallback (e.g., if XAUUSD somehow remains)
                defaultEntry = 2300.00;
                defaultSL = 40; 
                defaultTP = 80;
                config = { 
                    pipSize: 0.1,         
                    contractSize: 100,    
                    precision: 2          
                };
            }

            // Auto-fill logic
            if (!accountSize || accountSize <= 0) { accountSize = 10000; }
            if (!entryPrice || entryPrice <= 0) { entryPrice = defaultEntry; document.getElementById('forexEntryPrice').value = entryPrice; }
            if (!slPips || slPips <= 0) { slPips = defaultSL; document.getElementById('forexStopPips').value = slPips; }
            if (!tpPips || tpPips <= 0) { tpPips = defaultTP; document.getElementById('forexTpPips').value = tpPips; }
            
            
            // --- Lot Size Calculation ---
            const riskAmount = accountSize * (riskPercent / 100);
            let finalValuePerPipPerLot;

            if (pair === 'USDJPY') {
                // Pip Value in USD = (Pip Size * Contract Size) / Entry Price
                finalValuePerPipPerLot = (config.contractSize * config.pipSize) / entryPrice; 
            } else {
                // GBPUSD and other base currency pairs (Pip Value in USD = Pip Size * Contract Size)
                finalValuePerPipPerLot = config.contractSize * config.pipSize; 
            }
            
            // Lot Size = Risk Amount / (SL Pips * Pip Value per Lot in USD)
            const lots = riskAmount / (slPips * finalValuePerPipPerLot);
            
            // --- Price & R:R Calculation ---
            
            let priceUnitPerPip;
            if (pair === 'USDJPY') {
                priceUnitPerPip = 0.01;
            } else if (pair === 'GBPUSD') {
                priceUnitPerPip = 0.0001;
            } else {
                priceUnitPerPip = 0.1; // Fallback
            }
            
            const slDist = slPips * priceUnitPerPip;
            const tpDist = tpPips * priceUnitPerPip;

            const slPrice = tradeType === 'long' ? entryPrice - slDist : entryPrice + slDist;
            const tpPrice = tradeType === 'long' ? entryPrice + tpDist : entryPrice - tpDist;
            
            const profit = riskAmount * (tpPips / slPips);
            const rr = (tpPips / slPips).toFixed(2);

            const copyIcon = (val) => `<span class="copy-icon" onclick="copyText('${val}', this)"><svg viewBox="0 0 24 24" width="100%" height="100%"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></span>`;
            
            const html = `
            <table>
                <thead>
                    <tr>
                        <th colspan="2">${tradeType.toUpperCase()} POSITION  ${pair.toUpperCase()}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Lot Size</td><td>${lots.toFixed(2)} ${copyIcon(lots.toFixed(2))}</td></tr>
                    <tr><td>TP </td><td>${tpPrice.toFixed(config.precision)} ${copyIcon(tpPrice.toFixed(config.precision))}</td></tr>
                    <tr><td>SL </td><td>${slPrice.toFixed(config.precision)} ${copyIcon(slPrice.toFixed(config.precision))}</td></tr>
                    <tr><td>Profit</td><td class="profit-val">+$${profit.toFixed(2)}</td></tr>
                    <tr><td>Loss</td><td class="loss-val">-$${riskAmount.toFixed(2)}</td></tr>
                    <tr><td>Risk : Reward</td><td>1 : ${rr}</td></tr>
                </tbody>
            </table>`;

            out.innerHTML = html;
            out.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            selectCurrency('GBPUSD'); // Default GBPUSD
            selectRisk(1);
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark');
                setTheme('GBPUSD'); // Apply dark theme initially
            }
        });
    </script>
</body>
</html>
